%==============================================================================
\documentclass[11pt,oneside,onecolumn,letterpaper]{article}
\usepackage{times}
\usepackage[paperwidth=8.5in, paperheight=11in,
top=2.5cm, bottom=2.6cm, left=2.58cm, right=2.53cm]{geometry}
%\setlength{\textheight} {9.00in}
%\setlength{\textwidth}  {6.40in}
%\setlength{\topmargin}  {-0.50in}
%%\setlength{\headheight} {0.00in}
%%\setlength{\headsep}     {0.40in}
%\setlength{\oddsidemargin}{-0.010in}
%\setlength{\evensidemargin}{-0.00in}
%==============================================================================
%\usepackage{algorithm}
\usepackage{amssymb}
\usepackage{color}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{latexsym}
\usepackage{subfigure}
\usepackage{wrapfig}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage[hyphens]{url}
\usepackage{pifont}
\usepackage{color}
\usepackage{colortbl}
\usepackage[lined, boxed, linesnumbered]{algorithm2e}
\usepackage[square, comma, sort&compress, numbers]{natbib}

\newcounter{alg}
\newenvironment{enum-ref}{
\begin{list}%
{[\arabic{alg}]} {\usecounter{alg}
  \setlength{\leftmargin} {0.25in}
  \setlength{\labelwidth} {0.30in}
  \setlength{\rightmargin}{0.00in}
  \setlength{\topsep}     {0.00in}}
}{\end{list}}

\newenvironment{enum-number}{
\begin{list}%
{\arabic{alg})} {\usecounter{alg}
  \setlength{\leftmargin} {0.25in}
  \setlength{\labelwidth} {0.30in}
  \setlength{\rightmargin}{0.00in}
  \setlength{\topsep}     {0.00in}}
}{\end{list}}

\newenvironment{enum-nonum}{
\begin{list}%
{$\bullet$} {
  \setlength{\leftmargin} {0.25in}
  \setlength{\labelwidth} {0.30in}
  \setlength{\rightmargin}{0.00in}
  \setlength{\topsep}     {0.00in}}
}{\end{list}}

\let\chapter\section

%==============================================================================
\pagestyle{plain}
%==============================================================================

\title{Secure UAV Communications System Design}
\author{Team Cacti, University at Buffalo}
\date{}



\begin{document}
%%
%=============================================================================
\normalsize


\maketitle
%\date{}

\renewcommand{\thepage}{System Design, Cacti, UB--\arabic{page}}
\setcounter{page}{1} \normalsize
%
%\renewcommand{\baselinestretch}{1.2}
%\normalsize
%\vspace{0.1in}
%\centerline{\textbf{\Large }}
%\renewcommand{\baselinestretch}{1.0}
%\normalsize

\newcommand{\flagRollback}{\textsf{Rollback}\xspace}

\section{System Overview}

The transitions between SEDs will be encrypted.
Only the SEDs that have the correct key can decrypt the message.
All messages in between will be authenticated to check the integrity.

\subsection{Message Crypto}
To encrypt the message, asymmetric encryption (AES) is used.
Which we chose will be AES with CBC, CTR, or GCM mode.
The key is called SED\_aes\_key which is unique for each SED.
Every SED stores a list of keys for the activated SEDs which will be used to encrypt or decrypt the messages.

\subsubsection{Possible Asymmetric Crypto}
If the performance is good enough, we will additionally implement asymmetric encryption, such as RSA, to encrypt the AES key.
In this design, each SED has the AES key plus a pair of a public key (SED\_pub\_key) and a private key(SED\_pri\_key).
Also, each SED stores a list of public keys of the activated SEDs.

To send a message, SED\_a will use the AES key to encrypt the message body first (ciphertext), then use the SED\_b's public key to encrypt the AES key (en\_key).
Then send the en\_key and ciphertext to SED\_b'.

To read the message, SED\_b uses its private key to decrypt the en\_key to get the AES key, then encrypt the ciphertext. 

\subsection{Message Authentication}
To do authentication, there are two alternations to chosse which we prefer to use AES-GCM.
\begin{itemize}
  \item[1] hmac with size 512 (may change).
  The key for hmac is called SED\_hmac\_key.
  \item[2] AES with GCM mode.
\end{itemize}

\subsection{Message Continous}
Each transition will be tagged with a timestamp (or sequence number inside the message body) to prevent the replay attack.

\subsection{Key Generation and Storage}
SSS maintains all keys for all activated SEDs and its own keys.
This key list will be shared with each newly registered SED.

Like we discussed in previous sections, each provisioned SED also has its own SED\_key dictionary (SED\_hma\_key, SED\_aes\_key additionally with SED\_pub\_key and SED\_pri\_key) which will be used to encrypt and authenticate the message in transitions.

When register a SED, the SSS is responsible to generate the SED\_keys and update it.
The newly inserted SED will broadcast the key to other SEDs to update the key of the associated ID.

When deregistering a SED, the SED will broadcast to other SEDs first to delete the SED\_keys, then the SSS will destroy the SED\_keys in its own storage.

In detail:
\begin{itemize}
  \item When we add the SEDs with \textbf{add\_sed}  
      command we generate secrets for each SED. 
      \item We will use symmetric key encryption for SED to SED communication (AES).
      \item We change the  \textbf{dockerfiles/2b\_create\_sed\_secrets.Dockerfile} file to generate the keys for each pair of SEDs to communicate with each other.
      \item Store the keys in the containers \textbf{secret} directory.
      \item As every SED will have all the key pairs in the network, the authenticity of each message can be verified.
      % \item Along with the AES Keys for communication we may also generate one key for each SED to do \textbf{hmac} on the header and message body. 
      % Here the hmac preserves the integrity of the message header and message body.
\end{itemize}

\subsection{Secure the Broadcast}
Whenever the register or deregister happens, this SED will broadcast its status to update the SED\_keys stored in other SEDs.
Implementing the TESLA broadcast authentication protocol is in our work pipeline, too.

\subsubsection{Message format}
The original message format is eight bytes of metadata followed by the frame body.
We will change the frame body into an encrypted body with AES plus hmac of the header and encrypted body.

  \begin{itemize}
  \item In case of SED to SED communication: \textbf{header + hmac(header + AES (body)) + AES(body)} or \textbf{header + aes-gcm(header + body)}
  \item In case of incoming message from FAA transceiver we receive the message as given format: \textbf{header + body}
  \end{itemize}
  \begin{itemize}
  \item We will add a sequence number in from of the message body. We check the sequence number from the message after decryption to prevent reply attack.
  \end{itemize}

\subsection{Build Process}

  \begin{itemize}
    \item \textbf{dockerfiles/1a\_create\_sss.Dockerfile}: Generate or destory keys for SEDs registration and deregistration.
    \item \textbf{dockerfiles/2b\_create\_sed\_secrets.Dockerfile}: Store the key list for actived SEDs.
    \item \textbf{dockerfiles/2c\_build\_controller.Dockerfile}: Generate any other secrets.
    \item ...
  \end{itemize}

\section{Implementation}
\subsection{Critical Functions and Files}
\begin{itemize}
  \item sss.py: check the provisoned SEDs.
  \item controller.c: add message encryption, decryption, and authentication, update keys.
  \item others are still in progress.
\end{itemize}


% \section{Flag Protection}

% \subsection{\textsf{D}}


\end{document}
%==============================================================================
